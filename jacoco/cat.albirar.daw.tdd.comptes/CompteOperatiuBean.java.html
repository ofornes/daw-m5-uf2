<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ca"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CompteOperatiuBean.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tdd</a> &gt; <a href="index.source.html" class="el_package">cat.albirar.daw.tdd.comptes</a> &gt; <span class="el_source">CompteOperatiuBean.java</span></div><h1>CompteOperatiuBean.java</h1><pre class="source lang-java linenums">// Generated by delombok at Wed Apr 13 19:55:58 CEST 2022
/*
 * This file is part of &quot;tdd&quot;.
 * 
 * &quot;tdd&quot; is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * &quot;tdd&quot; is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with calendar.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 * Copyright (C) 2022 Octavi Fornés
 */
package cat.albirar.daw.tdd.comptes;

import java.time.LocalDate;
import java.util.Collections;
import java.util.Map;
import java.util.TreeMap;
import javax.validation.Valid;
import javax.validation.constraints.Min;
import lombok.Builder.Default;

/**
 * Compte operatiu per a sumar, restar saldo, etc.
 * @author Octavi Forn&amp;eacute;s &lt;mailto:ofornes@albirar.cat[]&gt;
 * @since 1.0.0
 */
@Valid
public class CompteOperatiuBean {
	private CompteBean compte;
	private Map&lt;LocalDate, Integer&gt; transferitDia;

	/**
	 * Afegeix la {@code quantitat} indicada al saldo.
	 * @param quantitat Els cèntims a sumar
	 * @return El saldo desprès de la suma
	 */
	public int sumarSaldo(@Min(1) int quantitat) {
<span class="fc" id="L46">		compte.amount += quantitat;</span>
<span class="fc" id="L47">		return compte.amount;</span>
	}

	/**
	 * Resta la {@code quantitat} indicada al saldo.
	 * @param quantitat Els cèntims a restar
	 * @return El saldo desprès de la resta
	 * @throws SaldoInsuficientException Si el saldo actual impedeix la substracció
	 */
	public int restarSaldo(@Min(1) int quantitat) {
<span class="fc bfc" id="L57" title="All 2 branches covered.">		if (compte.amount &lt; quantitat) {</span>
<span class="fc" id="L58">			throw new SaldoInsuficientException();</span>
		}
<span class="fc" id="L60">		compte.amount -= quantitat;</span>
<span class="fc" id="L61">		return compte.amount;</span>
	}

	/**
	 * Semblant a {@link #restarSaldo(int)}, però verifica que la operació no sobrepassi el {@code maximDiari} de transferència a data d'avui.
	 * &lt;strong&gt;Si execedix el màxim diari, no s'aplica la substracció&lt;/strong&gt;
	 * @param quantitat La quantitat
	 * @param maximDiari El màxim diari permès
	 * @return El total transferit a data d'avui
	 * @throws LimitDiariTransferenciesExceditException Si s'execedeix el {@code maximDiari}
	 */
	public int transferirSaldo(@Min(1) int quantitat, @Min(1) int maximDiari) {
		LocalDate data;
		Integer totalDia;
<span class="fc" id="L75">		data = LocalDate.now();</span>
<span class="fc" id="L76">		totalDia = transferitDia.get(data);</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">		if (totalDia == null) {</span>
<span class="fc" id="L78">			totalDia = Integer.valueOf(0);</span>
		}
<span class="fc bfc" id="L80" title="All 2 branches covered.">		if ((totalDia + quantitat) &gt; maximDiari) {</span>
<span class="fc" id="L81">			throw new LimitDiariTransferenciesExceditException(compte.getIdCompte(), maximDiari);</span>
		}
<span class="fc" id="L83">		totalDia = Integer.valueOf(totalDia.intValue() + quantitat);</span>
<span class="fc" id="L84">		transferitDia.put(data, totalDia);</span>
<span class="fc" id="L85">		restarSaldo(quantitat);</span>
<span class="fc" id="L86">		return totalDia;</span>
	}

	@java.lang.SuppressWarnings(&quot;all&quot;)
	private static Map&lt;LocalDate, Integer&gt; $default$transferitDia() {
<span class="fc" id="L91">		return Collections.synchronizedMap(new TreeMap&lt;&gt;());</span>
	}


	@java.lang.SuppressWarnings(&quot;all&quot;)
<span class="fc" id="L96">	public static abstract class CompteOperatiuBeanBuilder&lt;C extends CompteOperatiuBean, B extends CompteOperatiuBean.CompteOperatiuBeanBuilder&lt;C, B&gt;&gt; {</span>
		@java.lang.SuppressWarnings(&quot;all&quot;)
		private CompteBean compte;
		@java.lang.SuppressWarnings(&quot;all&quot;)
		private boolean transferitDia$set;
		@java.lang.SuppressWarnings(&quot;all&quot;)
		private Map&lt;LocalDate, Integer&gt; transferitDia$value;

		@java.lang.SuppressWarnings(&quot;all&quot;)
		protected abstract B self();

		@java.lang.SuppressWarnings(&quot;all&quot;)
		public abstract C build();

		/**
		 * @return {@code this}.
		 */
		@java.lang.SuppressWarnings(&quot;all&quot;)
		public B compte(final CompteBean compte) {
<span class="fc" id="L115">			this.compte = compte;</span>
<span class="fc" id="L116">			return self();</span>
		}

		/**
		 * @return {@code this}.
		 */
		@java.lang.SuppressWarnings(&quot;all&quot;)
		public B transferitDia(final Map&lt;LocalDate, Integer&gt; transferitDia) {
<span class="nc" id="L124">			this.transferitDia$value = transferitDia;</span>
<span class="nc" id="L125">			transferitDia$set = true;</span>
<span class="nc" id="L126">			return self();</span>
		}

		@java.lang.Override
		@java.lang.SuppressWarnings(&quot;all&quot;)
		public java.lang.String toString() {
<span class="nc" id="L132">			return &quot;CompteOperatiuBean.CompteOperatiuBeanBuilder(compte=&quot; + this.compte + &quot;, transferitDia$value=&quot; + this.transferitDia$value + &quot;)&quot;;</span>
		}
	}


	@java.lang.SuppressWarnings(&quot;all&quot;)
	private static final class CompteOperatiuBeanBuilderImpl extends CompteOperatiuBean.CompteOperatiuBeanBuilder&lt;CompteOperatiuBean, CompteOperatiuBean.CompteOperatiuBeanBuilderImpl&gt; {
		@java.lang.SuppressWarnings(&quot;all&quot;)
		private CompteOperatiuBeanBuilderImpl() {
		}

		@java.lang.Override
		@java.lang.SuppressWarnings(&quot;all&quot;)
		protected CompteOperatiuBean.CompteOperatiuBeanBuilderImpl self() {
<span class="fc" id="L146">			return this;</span>
		}

		@java.lang.Override
		@java.lang.SuppressWarnings(&quot;all&quot;)
		public CompteOperatiuBean build() {
<span class="fc" id="L152">			return new CompteOperatiuBean(this);</span>
		}
	}

	@java.lang.SuppressWarnings(&quot;all&quot;)
<span class="fc" id="L157">	protected CompteOperatiuBean(final CompteOperatiuBean.CompteOperatiuBeanBuilder&lt;?, ?&gt; b) {</span>
<span class="fc" id="L158">		this.compte = b.compte;</span>
<span class="pc bpc" id="L159" title="1 of 2 branches missed.">		if (b.transferitDia$set) this.transferitDia = b.transferitDia$value;</span>
<span class="fc" id="L160">		 else this.transferitDia = CompteOperatiuBean.$default$transferitDia();</span>
<span class="fc" id="L161">	}</span>

	@java.lang.SuppressWarnings(&quot;all&quot;)
	public static CompteOperatiuBean.CompteOperatiuBeanBuilder&lt;?, ?&gt; builder() {
<span class="fc" id="L165">		return new CompteOperatiuBean.CompteOperatiuBeanBuilderImpl();</span>
	}

	@java.lang.SuppressWarnings(&quot;all&quot;)
	public CompteBean getCompte() {
<span class="fc" id="L170">		return this.compte;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>